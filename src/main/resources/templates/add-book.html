<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Add New Book</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
</head>
<body>
<div class="container mt-5">
  <h2>Add New Book</h2>
  <form th:action="@{/book/add}" method="post">
    <!-- Basic book fields -->
    <div class="mb-3">
      <label for="isbn" class="form-label">ISBN</label>
      <input type="text" class="form-control" id="isbn" name="isbn" required>
    </div>

    <div class="mb-3">
      <label for="title" class="form-label">Title</label>
      <input type="text" class="form-control" id="title" name="title" required>
    </div>

    <div class="mb-3">
      <label for="description" class="form-label">Description</label>
      <textarea class="form-control" id="description" name="description" rows="3"></textarea>
    </div>

    <div class="mb-3">
      <label for="smallCoverUrl" class="form-label">Small Cover URL</label>
      <input type="url" class="form-control" id="smallCoverUrl" name="smallCoverUrl">
    </div>

    <div class="mb-3">
      <label for="bigCoverUrl" class="form-label">Big Cover URL</label>
      <input type="url" class="form-control" id="bigCoverUrl" name="bigCoverUrl">
    </div>

    <div class="mb-3">
      <label for="releaseDate" class="form-label">Release Date</label>
      <input type="date" class="form-control" id="releaseDate" name="releaseDate" required>
    </div>

    <!-- Authors section -->
    <div class="mb-3">
      <label class="form-label">Authors</label>
      <div class="mb-2">
        <select multiple class="form-select" id="authors" name="authorIds">
          <option th:each="author : ${authors}"
                  th:value="${author.id}"
                  th:text="${author.firstName + ' ' + author.lastName}">
          </option>
        </select>
      </div>

      <div id="newAuthorsContainer">
        <!-- New authors will be added here -->
      </div>

      <button type="button" class="btn btn-outline-secondary btn-sm mt-2" onclick="addNewAuthor()">
        + Add New Author
      </button>
    </div>

    <!-- Categories section -->
    <div class="mb-3">
      <label class="form-label">Categories</label>
      <div class="mb-2">
        <select multiple class="form-select" id="categories" name="categoryIds">
          <option th:each="category : ${categories}"
                  th:value="${category.id}"
                  th:text="${category.name}">
          </option>
        </select>
      </div>

      <div id="newCategoriesContainer">
        <!-- New categories will be added here -->
      </div>

      <button type="button" class="btn btn-outline-secondary btn-sm mt-2" onclick="addNewCategory()">
        + Add New Category
      </button>
    </div>

    <div class="mb-3 form-check">
      <input type="checkbox" class="form-check-input" id="isAvailable" name="isAvailable" checked>
      <label class="form-check-label" for="isAvailable">Available</label>
    </div>

    <button type="submit" class="btn btn-primary">Add Book</button>
  </form>
</div>

<script>
  let authorCount = 0;
  let categoryCount = 0;

  function addNewAuthor() {
    const container = document.getElementById('newAuthorsContainer');
    const authorDiv = document.createElement('div');
    authorDiv.className = 'row g-2 mb-2';
    authorDiv.innerHTML = `
        <div class="col-5">
            <input type="text" class="form-control" name="newAuthors[${authorCount}].firstName" placeholder="First Name" required>
        </div>
        <div class="col-5">
            <input type="text" class="form-control" name="newAuthors[${authorCount}].lastName" placeholder="Last Name" required>
        </div>
        <div class="col-2">
            <button type="button" class="btn btn-outline-danger" onclick="this.parentElement.parentElement.remove()">Remove</button>
        </div>
    `;
    container.appendChild(authorDiv);
    authorCount++;
  }

  function addNewCategory() {
    const container = document.getElementById('newCategoriesContainer');
    const categoryDiv = document.createElement('div');
    categoryDiv.className = 'row g-2 mb-2';
    categoryDiv.innerHTML = `
        <div class="col-10">
            <input type="text" class="form-control" name="newCategories[${categoryCount}].name" placeholder="Category Name" required>
        </div>
        <div class="col-2">
            <button type="button" class="btn btn-outline-danger" onclick="this.parentElement.parentElement.remove()">Remove</button>
        </div>
    `;
    container.appendChild(categoryDiv);
    categoryCount++;
  }
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>